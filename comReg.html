<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
<style>
        #log {
  overflow-x: hidden;
  background-image: linear-gradient(
    to right,
    #eeefef,
    #d2d5d7,
    #c3c5c4,
    #b2b3b4,
    #b6b8b8
    
  );
  height: 730px;
}
.container h2{
    color: #fefcfc;
}
</style>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" 
integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
</head>

<body>

<div id="log">
    <div class="container">
        <h2 class="text-center">User Registration</h2>
        <p>Please fill in this form to create an account.</p>
        <hr>
        <div style="margin-top: 20px;margin-left: 20px; width: 300px;" class="input-group" >
            <input type="search" placeholder="search for Upldate or Delete" id="search" class="form-control mr-sm-2" >
            <button id="searchbtn" type="button" class="btn btn-outline-danger my-2 my-sm-0">search</button>
        </div>
    <br>
        <form>
            <div class="form-group">
                <label for="nic" class="form-label">NIC</label>
                <input type="text" class="form-control" placeholder="Enter NIC" name="nic" id="nic" required>
            </div>

            <div class="form-group">
                <label for="fName" class="form-label">First Name</label>
                <input type="text" class="form-control" placeholder="First Name" name="fName" id="fName" required>
            </div>

            <div class="form-group">
                <label for="lName" class="form-label">Last Name</label>
                <input type="text" class="form-control" placeholder="Last Name" name="lName" id="lName" required>
            </div>

            <div class="form-group">
                <label>Province</label>
                <select name="pName" id="pName"  class="form-select">
                    <option value="Western">Western</option>
                    <option value="Southern">Southern</option>
                    <option value="Central">Central</option>
                    <option value="Northern">Northern</option>
                    <option value="Uva">Uva</option>
                    <option value="North Western">North Western</option>
                    <option value="North Central">North Central</option>
                    <option value="Sabaragamuwa">Sabaragamuwa</option>
                    <option value="Eastern">Eastern</option>
                </select>
            </div>

            <div class="form-group">
                <label>City</label>
                <select name="cName" id="cName"  class="form-select">
                    <option value="Colombo">Colombo</option>
                    <option value="Gampaha">Gampaha</option>
                    <option value="Kaluthara">Kaluthara</option>
                    <option value="Galle">Galle</option>
                    <option value="Matara">Matara</option>
                    <option value="Hambantota">Hambantota</option>
                    <option value="Kandy">Kandy</option>
                    <option value="Matale">Matale</option>
                    <option value="Nuwara Eliya">Nuwara Eliya</option>
                    <option value="Jaffna">Jaffna</option>
                    <option value="Kilinochchi">Kilinochchi</option>
                    <option value="Mannar">Mannar</option>
                    <option value="Mullaitivu">Mullaitivu</option>
                    <option value="Vavuniya">Vavuniya</option>
                    <option value="Badulla">Badulla</option>
                    <option value="Monaragala">Monaragala</option>
                    <option value="Kurunegala">Kurunegala</option>
                    <option value="Puttalam">Puttalam</option>
                    <option value="Anuradhapura">Anuradhapura</option>
                    <option value="Polonnaruwa">Polonnaruwa</option>
                    <option value="Kegalle">Kegalle</option>
                    <option value="Rathnapura">Rathnapura</option>
                    <option value="Ampara">Ampara</option>
                    <option value="Batticaloa">Batticaloa</option>
                    <option value="Trincomalee">Trincomalee</option>
                </select>
            </div>

            <div class="form-group">
                <label for="address" class="form-label">Address</label>
                <input type="text" class="form-control" placeholder="Address" name="address" id="address" required>
            </div>

            <div class="form-group">
                <label>Position</label>
                <select name="position" id="position"  class="form-select">
                    <option value="Admin">Admin</option>
                    <option value="Commissionar">Commissionar</option>
                    <option value="Officer">Officer</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tel" class="form-label">Contact Number</label>
                <input type="text" class="form-control" placeholder="Contact Number" name="tel" id="tel" required>
            </div>

            <div class="form-group">
                <label for="email" class="form-label">Email</label>
                <input type="text" class="form-control" placeholder="Email" name="email" id="email" required>
            </div>

            <div class="form-group">
                <label for="psw" class="form-label">Password</label>
                <input type="password" class="form-control" placeholder="Password" name="psw" id="psw" required>
            </div>

            <hr>

            <button type="button" id="submitData" name="submitData" class="btn btn-danger btn-block">Register</button>
            <button type="button" id="updatebtn" name="updatebtn" class="btn btn-danger btn-block">Update User</button>
            <button type="button" id="deletebtn" name="deletebtn" class="btn btn-danger btn-block">Delete User</button>
        </form>
    </div>

    <div class="QRWrapper">
        <div class="QRWrapperInner">
          <div class="qr-code-result">
            <p id="qr-result">Please Save the User QR code:</p>
            <canvas id="qr-code" style="background-color: white; width: 550px; height: 550px; padding: 10px 10px 10px 10px;"></canvas>
          </div>
        </div>
    </div>
</div>

</body>


</html>
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js";
    import {
        getAuth,
        createUserWithEmailAndPassword,
        signInWithEmailAndPassword,
        signOut
    } from "https://www.gstatic.com/firebasejs/9.20.0/firebase-auth.js";
    import {getDatabase, set, ref, child, update, get,
            query, orderByChild, equalTo, remove} from "https://www.gstatic.com/firebasejs/9.20.0/firebase-database.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    const firebaseConfig = {
        // Your configs
        apiKey: "AIzaSyCe_bkIeOc4zaiT1eOcKqySmv_CSfSwl7o",
        authDomain: "landregistration-6612a.firebaseapp.com",
        projectId: "landregistration-6612a",
        storageBucket: "landregistration-6612a.appspot.com",
        messagingSenderId: "113288186241",
        appId: "1:113288186241:web:4c9d1b4fdf0f0418c10080"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth();
    const database = getDatabase(app);

    submitData.addEventListener('click', (e) => {

        var email = document.getElementById('email').value;
        var password = document.getElementById('psw').value;
        var nic = document.getElementById('nic').value;
        var fName = document.getElementById('fName').value;
        var lName = document.getElementById('lName').value;
        var pName = document.getElementById('pName').value;
        var cName = document.getElementById('cName').value;
        var address = document.getElementById('address').value;
        var tel = document.getElementById('tel').value;
        var position = document.getElementById('position').value;
        var qr;
        var x;
       
    
        //sign up user
        createUserWithEmailAndPassword(auth, email, password)
            .then((userCredential) => {
                // Signed in
                var user = userCredential.user;
                // ... user.uid
                set(ref(database, 'officer/' + user.uid), {
                    id: user.uid,
                    email: email,
                    password: password,
                    nic: nic,
                    fName: fName,
                    lName: lName,
                    pName: pName,
                    cName: cName,
                    address: address,
                    tel: tel,
                    position: position
                })
                    .then(() => {
                        // Data saved successfully!
                        x=user.uid;
                        alert('Registered successfully');
                        (function() {
                            qr = new QRious({
                                element: document.getElementById('qr-code'),
                                size: 500,
                                value: 'https://blog.stackfindover.com/'
                            });
                        })();
                
              
                        var qrtext = x;
                        document.getElementById("qr-result").innerHTML = "QR code for " + qrtext +":";
                        //alert(qrtext);
                        qr.set({
                            foreground: '#000000',
                            size: 500,
                            value: qrtext
                        });
                    })
                    .catch((error) => {
                        // The write failed...
                        alert(error);
                    });
            })
            .catch((error) => {
                const errorCode = error.code;
                const errorMessage = error.message;
                // ..
                alert(errorMessage);
            });

    });

//.........................................................................................................
var updateId;
searchbtn.addEventListener('click', (e) => {

var i = document.getElementById('search').value;

const tasksRef = query(ref(database, "officer"), orderByChild("email"), equalTo(i) );
            
            get(tasksRef)
              .then((snapshot) => {
                var sti =[];
                snapshot.forEach(childSnapshot =>{
                  sti.push(childSnapshot.val());
                });    
                  //const data = snapshot.val();
                  console.log(sti);
                AddAllUser(sti);
              })
              .catch((err) => {
                console.error(err);
            });

});
function UserDetails(id,fName,lName,cName,pName,nic,address,tel,position,email,){
    updateId=id;
    document.getElementById('nic').value=nic;
    document.getElementById('fName').value=fName;
    document.getElementById('lName').value=lName;
    document.getElementById('pName').value=pName;
    document.getElementById('cName').value=cName;
    document.getElementById('address').value=address;
    document.getElementById('tel').value=tel;
    document.getElementById('position').value=position;


}

function AddAllUser(sti){
  
  sti.forEach(element =>{
  UserDetails(element.id,element.fName,element.lName,element.cName,element.pName,element.nic,element.address,element.tel,
  element.position,element.email)
  });
}

updatebtn.addEventListener('click', (e) => {
    var nic = document.getElementById('nic').value;
    var fName = document.getElementById('fName').value;
    var lName = document.getElementById('lName').value;
    var pName = document.getElementById('pName').value;
    var cName = document.getElementById('cName').value;
    var address = document.getElementById('address').value;
    var tel = document.getElementById('tel').value;
    var dob = document.getElementById('dob').value;
    update(ref(database, 'officer/' + updateId), {
                nic: nic,
                fName: fName,
                lName: lName,
                pName: pName,
                cName: cName,
                address: address,
                tel: tel,
                position: position
    })
    .then(()=>{
        alert("Updated Successfully");
    })
    .catch((error)=>{
        alert("unsuccessfully: "+error);
    })
});

deletebtn.addEventListener('click', (e) => {
    remove(ref(database, 'officer/' + updateId), {

    })
    .then(()=>{
        alert("Deleted Successfully");
    })
    .catch((error)=>{
        alert("unsuccessfully: "+error);
    })

});        
    

</script>





